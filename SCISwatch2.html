<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SCI Fan Deck â€” 44 Colors, Buttons On Top (Draggable)</title>
  <style>
    :root {
      --btn:#0a26ff;
      --btn-hover:#081bcc;
      --wrap-max:1100px;
      --card-w:190px;
      --card-h:310px;
      --card-r:12px;
      --spring: cubic-bezier(.16,.84,.24,1.10);
      --spring-fast: cubic-bezier(.15,.9,.1,1.05);
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body {
      margin:0;
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#fff;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
    }
    .wrap {
      width:min(92vw, var(--wrap-max));
      margin:80px auto;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:20px;
    }
    /* Buttons FIRST and with high stacking order */
    .nav-buttons {
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      position:relative;
      z-index:3000; /* stay above fan */
    }
    button {
      border:0;
      background:var(--btn);
      color:#fff;
      padding:10px 18px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
      box-shadow:0 8px 18px rgba(26,56,255,.18), 0 1px 2px rgba(0,0,0,.08);
    }
    button:hover{ background:var(--btn-hover); transform:translateY(-1px) }
    button:active{ transform:translateY(0) }
    #fan-container {
      position:relative;
      width:min(78vmin, 780px);
      height:min(78vmin, 780px);
      perspective:1200px;
      z-index:100; /* lower than buttons */
      filter: drop-shadow(0 20px 30px rgba(0,0,0,.10))
              drop-shadow(0 2px 6px rgba(0,0,0,.06));
      /* Allow smooth touch dragging without scrolling the page */
      touch-action:none;
    }
    .rivet{
      position:absolute; left:50%; top:50%;
      transform:translate(-50%,-50%);
      width:34px; height:34px; border-radius:50%;
      background:
        radial-gradient( circle at 35% 35%, #ffffff 0 25%, #d9dde4 26% 50%, #aeb5c0 51% 70%, #7f8794 71% 86%, #cfd4dc 87% 100%);
      box-shadow:
        inset 0 2px 4px rgba(255,255,255,.8),
        inset 0 -3px 6px rgba(0,0,0,.25),
        0 2px 8px rgba(0,0,0,.18);
      z-index:1000;
      pointer-events:none;
    }
    .swatch {
      position:absolute; top:50%; left:50%;
      width:var(--card-w); height:var(--card-h);
      transform-origin:0% 100%;
      /* Use CSS vars for drag offsets so we can snap back easily */
      --tx: 0px;
      --ty: 0px;
      --angle: 0deg;
      transform: translate(var(--tx), calc(-100% + var(--ty))) rotate(var(--angle));
      border-radius:var(--card-r);
      display:flex; align-items:flex-end;
      padding:18px 16px;
      color:#fff;
      font-weight:800; letter-spacing:.2px;
      text-shadow:0 1px 3px rgba(0,0,0,.45);
      transition: transform .7s var(--spring), filter .25s ease, z-index .2s ease;
      user-select:none;
      background-image:
        linear-gradient( to bottom, rgba(255,255,255,.16), rgba(255,255,255,0) 40%),
        linear-gradient( to top, rgba(0,0,0,.08), rgba(0,0,0,0) 60%);
      background-blend-mode: overlay, normal;
      /* Better touch dragging */
      touch-action:none;
      cursor: grab;
    }
    .swatch.dragging{
      cursor: grabbing;
      /* Remove transition during live drag for snappy feel */
      transition: filter .25s ease, z-index .2s ease;
    }
    .swatch span{ display:block; font-size:14px; opacity:.95; color:#fff; }
    .is-top{
      filter: drop-shadow(0 16px 20px rgba(20,28,36,.22))
              drop-shadow(0 3px 6px rgba(20,28,36,.12));
      animation: focusPop .5s var(--spring-fast);
    }
    @keyframes focusPop{
      0%   { transform: translate(var(--tx), calc(-100% + var(--ty))) rotate(var(--angle)) scale(1); }
      55%  { transform: translate(var(--tx), calc(-100% + var(--ty))) rotate(calc(var(--angle) + 4deg)) scale(1.035); }
      100% { transform: translate(var(--tx), calc(-100% + var(--ty))) rotate(var(--angle)) scale(1.02); }
    }
    .tilt-left  { transform: rotateX(2deg) rotateZ(-1.2deg); }
    .tilt-right { transform: rotateX(2deg) rotateZ(1.2deg); }

    @media (max-width:720px){
      #fan-container{ width:min(88vmin, 560px); height:min(88vmin, 560px) }
      :root{ --card-w:150px; --card-h:250px; --card-r:10px; }
      .wrap{ margin:70px auto; }
      button{ padding:9px 14px; font-size:14px }
      .nav-buttons{ margin-top:0; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Buttons first so they always sit on top visually -->
    <div class="nav-buttons" aria-label="Controls">
      <button id="btn-open" type="button">Open Fan Deck</button>
      <button id="btn-close" type="button">Close Fan Deck</button>
      <button id="btn-prev" type="button">Previous</button>
      <button id="btn-next" type="button">Next</button>
    </div>

    <div id="fan-container" aria-label="Color fan deck">
      <div class="rivet" aria-hidden="true"></div>
    </div>
  </div>

  <script>
    /* Full 44-color set */
    const colors = [
      { name: "Red", code: "316", hex: "#b11624" },
      { name: "Terra Cotta", code: "376", hex: "#78140c" },
      { name: "Burgundy", code: "375", hex: "#460013" },
      { name: "Orange", code: "317", hex: "#f07317" },
      { name: "Yellow", code: "330", hex: "#f6c431" },
      { name: "Dark Yellow", code: "331", hex: "#e3a100" },
      { name: "Blue", code: "915", hex: "#143d74" },
      { name: "Pale Blue", code: "521", hex: "#345a66" },
      { name: "Deep Blue", code: "353", hex: "#345a66" },
      { name: "Medium Blue", code: "360", hex: "#6497b4" },
      { name: "Aqua", code: "517", hex: "#17665f" },
      { name: "Green", code: "453", hex: "#286e1b" },
      { name: "Lime Green", code: "952", hex: "#86b900" },
      { name: "Light Green", code: "446", hex: "#c5cf8d" },
      { name: "Forest Green", code: "454", hex: "#0a3634" },
      { name: "Purple", code: "523", hex: "#512243" },
      { name: "Light Purple", code: "530", hex: "#8c90b2" },
      { name: "Dark Brown", code: "939", hex: "#2b1e08" },
      { name: "Chocolate", code: "933", hex: "#361301" },
      { name: "Light Brown", code: "248", hex: "#af8763" },
      { name: "Beige", code: "999", hex: "#d1ad95" },
      { name: "Pebblestone", code: "437", hex: "#ded5ad" },
      { name: "Almond", code: "431", hex: "#9b977b" },
      { name: "Black", code: "459", hex: "#000000" },
      { name: "Pale Grey", code: "306", hex: "#a0a6b2" },
      { name: "Steel Grey", code: "365", hex: "#474647" },
      { name: "Medium Grey", code: "663", hex: "#2d2d2d" },
      { name: "Charcoal", code: "470", hex: "#323637" },
      { name: "Grey", code: "305", hex: "#565c5b" },
      { name: "Light Grey", code: "885", hex: "#7c7e7d" },
      { name: "Silver", code: "524", hex: "#afb1ad" },
      { name: "Super White", code: "433", hex: "#ffffff" },
      /* Metallic series */
      { name: "Metallic Silver", code: "101", hex: "#C0C0C0" },
      { name: "Metallic Charcoal", code: "124", hex: "#333333" },
      { name: "Metallic Mocha", code: "128", hex: "#7B4F3D" },
      { name: "Metallic Hot Chocolate", code: "148", hex: "#5A2E2E" },
      { name: "Metallic Ruby", code: "135", hex: "#9B111E" },
      { name: "Metallic Violet Passion", code: "116", hex: "#800080" },
      { name: "Metallic Blue Mist", code: "112", hex: "#6699CC" },
      { name: "Metallic Aqua", code: "143", hex: "#00FFFF" },
      { name: "Metallic Olive Green", code: "113", hex: "#708238" },
      { name: "Metallic Orange", code: "138", hex: "#FF6600" },
      { name: "Metallic Copper", code: "129", hex: "#B87333" },
      { name: "Metallic Gold", code: "106", hex: "#d4af37" }
    ];

    const fan = document.getElementById('fan-container');
    const cards = [];
    let isOpen = false;
    let currentTop = 0;
    let tiltTimer;

    function createFan(){
      const total = colors.length;
      for (let i=0; i<total; i++){
        const c = colors[i];
        const el = document.createElement('div');
        el.className = 'swatch';
        el.style.backgroundColor = c.hex;
        el.innerHTML = `${c.name}<span>#${c.code}</span>`;
        el.style.setProperty('--angle', '0deg');
        el.style.setProperty('--tx', '0px');
        el.style.setProperty('--ty', '0px');
        el.style.zIndex = 10 + i; // base
        el.dataset.idx = i;
        fan.appendChild(el);
        cards.push(el);
        attachDrag(el, i);
      }
      bringToFront(0, false);
    }

    function layoutAngles(){
      const total = cards.length;
      const spread = 270;
      const offset = -135;
      const step = spread / (total - 1);
      cards.forEach((card, i) => {
        const a = offset + i * step;
        card.style.setProperty('--angle', a + 'deg');
        card.style.setProperty('--tx', '0px');
        card.style.setProperty('--ty', '0px');
        // Trigger the transform with transition
        card.style.transform = `translate(var(--tx), calc(-100% + var(--ty))) rotate(${a}deg)`;
      });
    }

    function openFan(){
      if (isOpen) return;
      isOpen = true;
      layoutAngles();
      bringToFront(currentTop, true);
    }

    function closeFan(){
      if (!isOpen) return;
      isOpen = false;
      cards.forEach((card) => {
        card.style.setProperty('--tx', '0px');
        card.style.setProperty('--ty', '0px');
        card.style.setProperty('--angle', '0deg');
        card.style.transform = `translate(var(--tx), calc(-100% + var(--ty))) rotate(0deg)`;
        card.classList.remove('is-top');
      });
      fan.classList.remove('tilt-left','tilt-right');
    }

    function bringToFront(i, animateTilt=true){
      cards.forEach((el, idx) => {
        el.classList.toggle('is-top', idx === i);
        el.style.zIndex = (idx === i) ? 999 : (10 + idx);
      });
      if (animateTilt){
        fan.classList.remove('tilt-left','tilt-right');
        void fan.offsetWidth;
        const cls = (Math.random() > 0.5) ? 'tilt-left' : 'tilt-right';
        fan.classList.add(cls);
        clearTimeout(tiltTimer);
        tiltTimer = setTimeout(()=> fan.classList.remove('tilt-left','tilt-right'), 360);
      }
    }

    function nextSwatch(){
      if (!isOpen){ openFan(); return; }
      currentTop = (currentTop + 1) % cards.length;
      bringToFront(currentTop, true);
      microWiggle(+1);
    }
    function prevSwatch(){
      if (!isOpen){ openFan(); return; }
      currentTop = (currentTop - 1 + cards.length) % cards.length;
      bringToFront(currentTop, true);
      microWiggle(-1);
    }

    function microWiggle(dir=1){
      cards.forEach(card => {
        const angle = parseFloat(card.style.getPropertyValue('--angle')) || 0;
        const wiggle = angle + (2 * dir);
        card.style.transform = `translate(var(--tx), calc(-100% + var(--ty))) rotate(${wiggle}deg)`;
        requestAnimationFrame(()=>{
          card.style.transform = `translate(var(--tx), calc(-100% + var(--ty))) rotate(${angle}deg)`;
        });
      });
    }

    // ===== Drag logic (pointer events: works for mouse + touch) =====
    function attachDrag(el, idx){
      let startX=0, startY=0, startTX=0, startTY=0;
      const onPointerMove = (e)=>{
        if (!el.classList.contains('dragging')) return;
        e.preventDefault();
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        el.style.setProperty('--tx', (startTX + dx) + 'px');
        el.style.setProperty('--ty', (startTY + dy) + 'px');
      };
      const onPointerUp = ()=>{
        if (!el.classList.contains('dragging')) return;
        el.releasePointerCapture && el.releasePointerCapture(activePointerId);
        el.classList.remove('dragging');
        // snap back to original
        el.style.setProperty('--tx', '0px');
        el.style.setProperty('--ty', '0px');
        // allow CSS transition to animate back (transform transition on .swatch)
        window.removeEventListener('pointermove', onPointerMove, {passive:false});
        window.removeEventListener('pointerup', onPointerUp);
        window.removeEventListener('pointercancel', onPointerUp);
      };
      let activePointerId = null;

      el.addEventListener('pointerdown', (e)=>{
        if (!isOpen) openFan();
        activePointerId = e.pointerId;
        el.setPointerCapture && el.setPointerCapture(activePointerId);
        bringToFront(idx, true);
        currentTop = idx;
        el.classList.add('dragging');
        // record starting positions
        startX = e.clientX;
        startY = e.clientY;
        startTX = parseFloat(el.style.getPropertyValue('--tx')) || 0;
        startTY = parseFloat(el.style.getPropertyValue('--ty')) || 0;
        window.addEventListener('pointermove', onPointerMove, {passive:false});
        window.addEventListener('pointerup', onPointerUp);
        window.addEventListener('pointercancel', onPointerUp);
      });
    }

    window.addEventListener('load', () => {
      createFan();
      setTimeout(openFan, 120);
      document.getElementById('btn-open').addEventListener('click', openFan);
      document.getElementById('btn-close').addEventListener('click', closeFan);
      document.getElementById('btn-prev').addEventListener('click', prevSwatch);
      document.getElementById('btn-next').addEventListener('click', nextSwatch);
    });
  </script>
</body>
</html>
