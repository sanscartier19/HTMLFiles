<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SCI Fan Deck — 360 Spin + Realistic</title>
<style>
  :root{
    --btn:#0a26ff; --btn-hover:#081bcc;
    --wrap-max:1100px;
    --card-w:190px; --card-h:310px; --card-r:12px;
    --spring:cubic-bezier(.16,.84,.24,1.10);
    --spread:270;         /* total degrees of fan when open */
    --offset:-135;        /* center the fan (-spread/2) */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:#f6f7fb; display:flex; justify-content:center; align-items:flex-start; min-height:100vh;
  }
  .wrap{width:min(92vw,var(--wrap-max)); margin:80px auto; display:flex; flex-direction:column; align-items:center; gap:20px;}
  .nav-buttons{display:flex; gap:12px; flex-wrap:wrap; justify-content:center; position:relative; z-index:3000;}
  button{
    border:0; background:var(--btn); color:#fff; padding:10px 18px; border-radius:10px; font-weight:700; cursor:pointer;
    transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
    box-shadow:0 8px 18px rgba(26,56,255,.18), 0 1px 2px rgba(0,0,0,.08);
  }
  button:hover{background:var(--btn-hover); transform:translateY(-1px)}
  #fan-container{
    position:relative; width:min(78vmin,780px); height:min(78vmin,780px); perspective:1200px; z-index:100;
    filter:drop-shadow(0 24px 38px rgba(0,0,0,.12)) drop-shadow(0 4px 10px rgba(0,0,0,.06));
    touch-action:none;
  }

  /* realistic base disc */
  .hub{
    position:absolute; inset:8% 8% 8% 8%; border-radius:50%;
    background:
      radial-gradient(closest-side, rgba(255,255,255,.10), rgba(0,0,0,.08)),
      radial-gradient(circle at 40% 35%, #fff 0 15%, #f2f3f6 16% 50%, #e6e8ee 51% 70%, #d8dbe4 71% 99%, #c8ccd6 100%);
    box-shadow: inset 0 30px 60px rgba(0,0,0,.08), inset 0 -20px 40px rgba(255,255,255,.5);
    filter: blur(0.2px);
    pointer-events:none;
  }

  .rivet{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:40px; height:40px; border-radius:50%;
    background:
      radial-gradient(circle at 35% 35%, #ffffff 0 24%, #d9dde4 25% 50%, #aeb5c0 51% 68%, #7f8794 69% 86%, #cfd4dc 87% 100%);
    box-shadow:
      inset 0 2px 5px rgba(255,255,255,.85),
      inset 0 -5px 10px rgba(0,0,0,.30),
      0 8px 18px rgba(0,0,0,.22);
    z-index:1000; cursor:grab;
  }
  .rivet:active{cursor:grabbing}

  .swatch{
    position:absolute; top:50%; left:50%;
    width:var(--card-w); height:var(--card-h); transform-origin:0% 100%;
    --angle:0deg;
    transform:translate(0,-100%) rotate(var(--angle));
    border-radius:var(--card-r); display:flex; align-items:flex-end; padding:18px 16px;
    color:#fff; font-weight:800; letter-spacing:.2px; text-shadow:0 1px 3px rgba(0,0,0,.45);
    transition:transform .55s var(--spring), filter .25s ease, z-index .2s ease;
    user-select:none;
    /* paper realism */
    box-shadow:
      0 14px 24px rgba(15,23,42,.18),
      0 2px 6px rgba(15,23,42,.14);
    position:absolute;
    background-image:
      linear-gradient(to bottom, rgba(255,255,255,.18), rgba(255,255,255,0) 42%),
      linear-gradient(to top, rgba(0,0,0,.10), rgba(0,0,0,0) 60%);
    background-blend-mode:overlay,normal;
    cursor:grab;
    overflow:hidden;
  }
  /* subtle bevel/edge thickness */
  .swatch::before{
    content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
    box-shadow: inset 0 1.2px 0 rgba(255,255,255,.9), inset 0 -1.4px 0 rgba(0,0,0,.35);
    mix-blend-mode:soft-light;
  }
  .swatch span{display:block; font-size:14px;}
  .swatch.dragging{cursor:grabbing; transition:filter .25s ease, z-index .2s ease;}
  .swatch.swaying{transition:transform .15s ease-out;}
  .is-top{filter:drop-shadow(0 16px 22px rgba(20,28,36,.22)) drop-shadow(0 3px 7px rgba(20,28,36,.12));}

  /* Image-backed swatches show true image (no extra overlays) */
  .swatch.has-image{
    background-blend-mode:normal;
    background-repeat:no-repeat;
    background-position:center;
    background-size:cover;
    text-shadow:0 1px 2px rgba(0,0,0,.35);
  }
  /* moving metallic glare on hover for images */
  .swatch.has-image::after{
    content:""; position:absolute; inset:-20% -60%; pointer-events:none;
    background:linear-gradient(65deg, rgba(255,255,255,0) 45%, rgba(255,255,255,.35) 50%, rgba(255,255,255,0) 55%);
    transform:translateX(-120%) rotate(0.0001deg);
    transition:transform .9s ease;
    filter:blur(1px);
  }
  .swatch.has-image:hover::after{ transform:translateX(120%) rotate(0.0001deg); }

  /* Preview popup */
  .preview{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:5000;}
  .preview.open{display:flex;}
  .preview-box{width:min(92vw,520px); border-radius:14px; overflow:hidden; box-shadow:0 12px 40px rgba(0,0,0,.35); background:#fff;}
  .preview-color{height:260px;}
  .preview-meta{padding:16px; display:flex; align-items:center; justify-content:space-between; font-weight:800;}
  .close-x{border:0; background:#111; color:#fff; padding:8px 12px; border-radius:10px; cursor:pointer;}

  @media (max-width:720px){
    #fan-container{ width:min(88vmin,560px); height:min(88vmin,560px) }
    :root{ --card-w:150px; --card-h:250px; --card-r:10px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="nav-buttons">
    <button id="btn-open">Open Fan Deck</button>
    <button id="btn-close">Close Fan Deck</button>
    <button id="btn-rot-l">Rotate ◄</button>
    <button id="btn-rot-r">Rotate ►</button>
    <button id="btn-prev">Previous</button>
    <button id="btn-next">Next</button>
  </div>
  <div id="fan-container">
    <div class="hub"></div>
    <div class="rivet" id="rivet" title="Drag to rotate 360°"></div>
  </div>
</div>

<!-- preview overlay -->
<div class="preview" id="preview">
  <div class="preview-box">
    <div class="preview-color" id="previewColor"></div>
    <div class="preview-meta">
      <div id="previewLabel">Color — #000</div>
      <button class="close-x" id="closePreview">Close</button>
    </div>
  </div>
</div>

<script>
/* ---- 44 swatches; metallic use your PNGs ---- */
const colors=[
  { name:"Red", code:"316", hex:"#b11624" },
  { name:"Terra Cotta", code:"376", hex:"#78140c" },
  { name:"Burgundy", code:"375", hex:"#460013" },
  { name:"Orange", code:"317", hex:"#f07317" },
  { name:"Yellow", code:"330", hex:"#f6c431" },
  { name:"Dark Yellow", code:"331", hex:"#e3a100" },
  { name:"Blue", code:"915", hex:"#143d74" },
  { name:"Pale Blue", code:"521", hex:"#345a66" },
  { name:"Deep Blue", code:"353", hex:"#345a66" },
  { name:"Medium Blue", code:"360", hex:"#6497b4" },
  { name:"Aqua", code:"517", hex:"#17665f" },
  { name:"Green", code:"453", hex:"#286e1b" },
  { name:"Lime Green", code:"952", hex:"#86b900" },
  { name:"Light Green", code:"446", hex:"#c5cf8d" },
  { name:"Forest Green", code:"454", hex:"#0a3634" },
  { name:"Purple", code:"523", hex:"#512243" },
  { name:"Light Purple", code:"530", hex:"#8c90b2" },
  { name:"Dark Brown", code:"939", hex:"#2b1e08" },
  { name:"Chocolate", code:"933", hex:"#361301" },
  { name:"Light Brown", code:"248", hex:"#af8763" },
  { name:"Beige", code:"999", hex:"#d1ad95" },
  { name:"Pebblestone", code:"437", hex:"#ded5ad" },
  { name:"Almond", code:"431", hex:"#9b977b" },
  { name:"Black", code:"459", hex:"#000000" },
  { name:"Pale Grey", code:"306", hex:"#a0a6b2" },
  { name:"Steel Grey", code:"365", hex:"#474647" },
  { name:"Medium Grey", code:"663", hex:"#2d2d2d" },
  { name:"Charcoal", code:"470", hex:"#323637" },
  { name:"Grey", code:"305", hex:"#565c5b" },
  { name:"Light Grey", code:"885", hex:"#7c7e7d" },
  { name:"Silver", code:"524", hex:"#afb1ad" },
  { name:"Super White", code:"433", hex:"#ffffff" },

  /* Metallic series (images) */
  { name:"Metallic Silver", code:"101", img:"https://sanscartier19.github.io/HTMLFiles/101%20Silver%20Metallic.png" },
  { name:"Metallic Charcoal", code:"124", img:"https://sanscartier19.github.io/HTMLFiles/Charcoal.png" },
  { name:"Metallic Mocha", code:"128", img:"https://sanscartier19.github.io/HTMLFiles/Mocha.png" },
  { name:"Metallic Hot Chocolate", code:"148", img:"https://sanscartier19.github.io/HTMLFiles/HotChocolate.png" },
  { name:"Metallic Ruby", code:"135", img:"https://sanscartier19.github.io/HTMLFiles/Ruby.png" },
  { name:"Metallic Violet Passion", code:"116", img:"https://sanscartier19.github.io/HTMLFiles/VioletPassion.png" },
  { name:"Metallic Blue Mist", code:"112", img:"https://sanscartier19.github.io/HTMLFiles/BlueMist.jpg" },
  { name:"Metallic Aqua", code:"143", img:"https://sanscartier19.github.io/HTMLFiles/Aqua.png" },
  { name:"Metallic Olive Green", code:"113", img:"https://sanscartier19.github.io/HTMLFiles/OliveGreen.png" },
  { name:"Metallic Orange", code:"138", img:"https://sanscartier19.github.io/HTMLFiles/MetallicOrange.png" },
  { name:"Metallic Copper", code:"129", img:"https://sanscartier19.github.io/HTMLFiles/Copper.png" },
  { name:"Metallic Gold", code:"106", img:"https://sanscartier19.github.io/HTMLFiles/Gold.png" }
];

/* ---- helpers ---- */
const fan = document.getElementById('fan-container');
const rivet = document.getElementById('rivet');
const cards = [];
let isOpen = false, currentTop = 0, slotAngles = [];
const SPREAD = 270, OFFSET = -135;
let globalRotation = 0; // <-- NEW: full 360° deck rotation

const preview = document.getElementById('preview');
const previewColor = document.getElementById('previewColor');
const previewLabel = document.getElementById('previewLabel');
document.getElementById('closePreview').addEventListener('click', ()=> preview.classList.remove('open'));
preview.addEventListener('click', e=>{ if(e.target===preview) preview.classList.remove('open'); });

function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }
function normDeg(rad){ let d=rad*180/Math.PI; while(d>180)d-=360; while(d<-180)d+=360; return d; }
function getCenter(){ const r=fan.getBoundingClientRect(); return {cx:r.left+r.width/2, cy:r.top+r.height/2}; }
function wrapDeg(d){ d%=360; if(d<-360) d+=360; if(d>360) d-=360; return d; }

function bringToFront(idx){
  cards.forEach((el,i)=>{ el.classList.toggle('is-top', i===idx); el.style.zIndex=(i===idx)?999:(10+i); });
}
function relayout(){
  // base transform includes globalRotation for 360° spin
  const base = `translate(0,-100%)`;
  cards.forEach((el)=>{
    const ang = parseFloat(el.dataset.angle);
    const final = ang + globalRotation;
    el.style.setProperty('--angle', final+'deg');
    el.style.transform = `${base} rotate(${final}deg)`;
  });
}

/* ---- neighbor sway (unchanged) ---- */
function applyNeighborSway(dragEl, targetAngle, startAngle, angVel){
  const dragSlot = parseInt(dragEl.dataset.slot,10);
  const delta = targetAngle - startAngle;
  const baseSway = delta * 0.25;
  const speedBoost = clamp(Math.abs(angVel)*120, 0, 6);
  const swayMax = 10;

  cards.forEach((el)=>{
    if (el===dragEl) return;
    const slot = parseInt(el.dataset.slot,10);
    const dist = Math.abs(slot - dragSlot);
    if (dist===0 || dist>6){
      el.classList.remove('swaying');
      el.style.transform = `translate(0,-100%) rotate(${parseFloat(el.dataset.angle)+globalRotation}deg)`;
      return;
    }
    const falloff = Math.exp(-0.9*(dist-1));
    const sway = clamp((baseSway*falloff) + (Math.sign(delta)*speedBoost*falloff), -swayMax, swayMax);
    const ang = parseFloat(el.dataset.angle)+globalRotation;
    el.classList.add('swaying');
    el.style.transform = `translate(0,-100%) rotate(${ang + sway}deg)`;
  });
}
function clearNeighborSway(){
  cards.forEach(el=>{
    el.classList.remove('swaying');
    el.style.transform = `translate(0,-100%) rotate(${parseFloat(el.dataset.angle)+globalRotation}deg)`;
  });
}

/* ---- build deck ---- */
function createFan(){
  const step = SPREAD / (colors.length - 1);
  slotAngles = colors.map((_,i)=> OFFSET + i*step);

  colors.forEach((c,i)=>{
    const el = document.createElement('div');
    el.className = 'swatch';

    if (c.img){
      el.classList.add('has-image');
      el.style.background = `#fff url("${c.img}") center/cover no-repeat`;
    } else {
      el.style.backgroundColor = c.hex || '#999';
    }

    el.innerHTML = `${c.name}<span>#${c.code}</span>`;
    el.dataset.name=c.name; el.dataset.code=c.code; el.dataset.hex=c.hex||'';
    el.dataset.slot=i; el.dataset.angle=slotAngles[i];
    el.style.zIndex = 10 + i;
    fan.appendChild(el);
    cards.push(el);
    attachDragRotate(el, i);
  });

  bringToFront(0);
  relayout();
}

/* ---- open/close + prev/next ---- */
function openFan(){
  isOpen = true;
  cards.forEach(el=>{ el.dataset.angle = slotAngles[parseInt(el.dataset.slot,10)]; });
  relayout();
}
function closeFan(){
  isOpen = false;
  cards.forEach(el=>{
    el.dataset.angle = 0;
    el.classList.remove('is-top');
  });
  relayout();
}
function nextSwatch(){ if(!isOpen){openFan();return;} currentTop=(currentTop+1)%cards.length; bringToFront(currentTop); }
function prevSwatch(){ if(!isOpen){openFan();return;} currentTop=(currentTop-1+cards.length)%cards.length; bringToFront(currentTop); }

/* ---- drag a swatch (as before) ---- */
function attachDragRotate(el){
  let startX=0, startY=0, startAngle=0;
  let displayedAngle=0, lastTargetAngle=0;
  let lastT=0, lastA=0;
  let dragged=false, downTime=0;
  const moveThreshold=6, clickDelay=300;
  let activePointerId=null;

  const MIN_ANG = -135, MAX_ANG = 135;

  const onMove = (e)=>{
    if(!el.classList.contains('dragging')) return;
    e.preventDefault();
    const {cx, cy} = getCenter();
    const x=e.clientX, y=e.clientY;
    const raw = normDeg(Math.atan2(y - cy, x - cx));
    // clamp within fan spread; globalRotation already applied elsewhere
    const target = clamp(raw - globalRotation, MIN_ANG, MAX_ANG);

    const stiffness = 0.75;
    displayedAngle = displayedAngle + (target - displayedAngle) * stiffness;

    el.style.transition = 'filter .25s ease, z-index .2s ease';
    el.dataset.angle = displayedAngle;

    const t = e.timeStamp;
    const dt = Math.max(1, t - lastT);
    const angVel = (target - lastTargetAngle) / dt;
    lastT = t; lastTargetAngle = target;

    if(!dragged){
      const dx=Math.abs(x-startX), dy=Math.abs(y-startY);
      if(dx>moveThreshold || dy>moveThreshold) dragged=true;
    }

    applyNeighborSway(el, target, startAngle, angVel);
    lastA = target;
    relayout();
  };

  const onUp = ()=>{
    if(!el.classList.contains('dragging')) return;
    el.releasePointerCapture && el.releasePointerCapture(activePointerId);
    el.classList.remove('dragging');

    window.removeEventListener('pointermove', onMove, {passive:false});
    window.removeEventListener('pointerup', onUp);
    window.removeEventListener('pointercancel', onUp);

    const elapsed = Date.now() - downTime;
    if(!dragged && elapsed<=clickDelay){
      // click-only preview
      const isImg = el.classList.contains('has-image');
      if (isImg){
        previewColor.style.background = el.style.background;
      } else {
        previewColor.style.background = el.style.backgroundColor || '#fff';
      }
      previewLabel.textContent = `${el.dataset.name} — #${el.dataset.code}`;
      preview.classList.add('open');
      clearNeighborSway();
      el.style.transition = 'transform .55s var(--spring), filter .25s ease, z-index .2s ease';
      return;
    }

    // snap to nearest slot
    const current = parseFloat(el.dataset.angle);
    const toSlot = nearestSlot(current);
    const fromSlot = parseInt(el.dataset.slot,10);

    const w = (lastTargetAngle - lastA) / Math.max(1, (performance.now() - lastT));
    const overshoot = clamp(Math.abs(w)*180, 0, 7) * Math.sign(lastTargetAngle - startAngle);

    if(toSlot !== fromSlot){
      cards.forEach((c)=>{
        const s = parseInt(c.dataset.slot,10);
        if(c===el){
          c.dataset.slot = toSlot;
          c.dataset.angle = slotAngles[toSlot];
        }else{
          if(fromSlot < toSlot && s>fromSlot && s<=toSlot){ c.dataset.slot = s-1; c.dataset.angle = slotAngles[s-1]; }
          if(fromSlot > toSlot && s>=toSlot && s<fromSlot){ c.dataset.slot = s+1; c.dataset.angle = slotAngles[s+1]; }
        }
      });
      cards.sort((a,b)=> parseInt(a.dataset.slot,10) - parseInt(b.dataset.slot,10));
      bringToFront(cards.indexOf(el));
    } else {
      el.dataset.angle = slotAngles[fromSlot];
    }

    cards.forEach(c=> c.style.transition = 'transform .55s var(--spring), filter .25s ease, z-index .2s ease');

    const finalAngle = parseFloat(el.dataset.angle);
    clearNeighborSway();
    if (el.animate){
      const base = `translate(0,-100%)`;
      el.animate([
        { transform: `${base} rotate(${current+globalRotation}deg)` },
        { transform: `${base} rotate(${finalAngle + overshoot + globalRotation}deg)` },
        { transform: `${base} rotate(${finalAngle + globalRotation}deg)` },
      ], { duration: 420, easing: 'cubic-bezier(.16,.84,.24,1.10)' });
    }
    relayout();
  };

  el.addEventListener('pointerdown', (e)=>{
    if(!isOpen) openFan();
    activePointerId = e.pointerId;
    el.setPointerCapture && el.setPointerCapture(activePointerId);
    bringToFront(cards.indexOf(el));
    currentTop = cards.indexOf(el);
    el.classList.add('dragging');

    startX = e.clientX; startY = e.clientY;
    startAngle = parseFloat(el.dataset.angle) || 0;
    displayedAngle = startAngle;
    lastTargetAngle = startAngle;
    lastT = e.timeStamp; lastA = startAngle;
    dragged=false; downTime=Date.now();

    window.addEventListener('pointermove', onMove, {passive:false});
    window.addEventListener('pointerup', onUp);
    window.addEventListener('pointercancel', onUp);
  });
}

/* ---- 360° GLOBAL ROTATION CONTROLS ---- */
function rotateDeck(delta){
  globalRotation = wrapDeg(globalRotation + delta);
  relayout();
}
function pointerAngleFromCenter(e){
  const {cx, cy} = getCenter();
  return Math.atan2(e.clientY - cy, e.clientX - cx) * 180/Math.PI;
}
let spinning = false, spinStartAngle = 0, spinStartGlobal = 0;
rivet.addEventListener('pointerdown', (e)=>{
  e.preventDefault(); spinning = true; rivet.setPointerCapture && rivet.setPointerCapture(e.pointerId);
  spinStartAngle = pointerAngleFromCenter(e);
  spinStartGlobal = globalRotation;
});
window.addEventListener('pointermove', (e)=>{
  if(!spinning) return;
  const a = pointerAngleFromCenter(e);
  const delta = a - spinStartAngle;
  globalRotation = wrapDeg(spinStartGlobal + delta);
  relayout();
});
function endSpin(e){ if(!spinning) return; spinning=false; rivet.releasePointerCapture && rivet.releasePointerCapture(e.pointerId); }
window.addEventListener('pointerup', endSpin);
window.addEventListener('pointercancel', endSpin);

/* Mouse wheel spin */
fan.addEventListener('wheel', (e)=>{
  e.preventDefault();
  const step = (e.deltaY>0 ? 6 : -6);
  rotateDeck(step);
}, {passive:false});

/* ---- init ---- */
function nearestSlot(angleDeg){
  let best=0,bd=1e9; for(let i=0;i<slotAngles.length;i++){const d=Math.abs(slotAngles[i]-angleDeg); if(d<bd){bd=d;best=i;}} return best;
}
window.addEventListener('load', ()=>{
  createFan();
  closeFan(); // <-- CLOSED ON LOAD
  document.getElementById('btn-open').addEventListener('click', openFan);
  document.getElementById('btn-close').addEventListener('click', closeFan);
  document.getElementById('btn-prev').addEventListener('click', prevSwatch);
  document.getElementById('btn-next').addEventListener('click', nextSwatch);
  document.getElementById('btn-rot-l').addEventListener('click', ()=> rotateDeck(-10));
  document.getElementById('btn-rot-r').addEventListener('click', ()=> rotateDeck(10));
});
</script>
</body>
</html>
